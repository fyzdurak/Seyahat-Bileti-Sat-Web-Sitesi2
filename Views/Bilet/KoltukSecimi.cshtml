@model BiletSatisWebApp.Models.ViewModel.KoltukSecimiVM
<h2>Koltuk Seçimi</h2>

<p>
    Sefer: @Model.Trip.FromCity → @Model.Trip.ToCity
    @* (@Model.Trip.DepartureTime.ToString("dd.MM.yyyy HH:mm")) *@
</p>

<div id="bus-interior" class="bus-interior">
    <div class="bus-section">
        <h3>Konteyner Koltukları</h3>
        <div class="seat-row">
            @for (int i = 1; i <= 4; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
        <div class="seat-row">
            @for (int i = 5; i <= 8; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
    </div>
    <div class="bus-section">
        <h3>İkinci Konteyner Koltukları</h3>
        <div class="seat-row">
            @for (int i = 9; i <= 12; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
        <div class="seat-row">
            @for (int i = 13; i <= 16; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
    </div>
    <div class="bus-section">
        <h3>Arka Koltuklar</h3>
        <div class="seat-row">
            @for (int i = 17; i <= 20; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
        <div class="seat-row">
            @for (int i = 21; i <= 24; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
    </div>
    <div class="bus-section">
        <h3>Galeri Koltukları</h3>
        <div class="seat-row">
            @for (int i = 25; i <= 30; i++)
            {
                <button class="seat @(Model.SelectedSeats.Contains(i) ? "selected" : "")" data-seat-id="@i" onclick="selectSeat(@i)">
                    @i
                </button>
            }
        </div>
    </div>
</div>

<!-- Geri Butonu -->
 <a href="@Url.Action("OtobusListesi", "Bilet", new { nereden = Model.Trip.FromCity, nereye = Model.Trip.ToCity, gidisTarihi = Model.Trip.DepartureDate.ToString("dd.MM.yyyy") })" class="btn btn-secondary">← Geri</a> 

<!-- Devam Butonu -->
<button id="continue-button" class="btn btn-primary" onclick="submitSelectedSeats()">Devam</button>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function selectSeat(seatId) {
        const seatButton = document.querySelector(`button[data-seat-id='${seatId}']`);
        if (seatButton.classList.contains('selected')) {
            seatButton.classList.remove('selected');
        } else {
            seatButton.classList.add('selected');
        }
    }

    function submitSelectedSeats() {
        const selectedSeats = Array.from(document.querySelectorAll('.seat.selected')).map(seat => seat.getAttribute('data-seat-id'));
        if (selectedSeats.length === 0) {
            Swal.fire({
                icon: 'warning',
                title: 'Uyarı!',
                text: 'Lütfen bir koltuk seçiniz!'
            });
            return;
        }

        // Post the selected seats to the server
        fetch('@Url.Action("KoltukSecimi", "Bilet")', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ tripId: @Model.Trip.Id, selectedSeats: selectedSeats })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Başarılı!',
                    text: 'Koltuk seçimi tamamlandı!'
                }).then(() => {
                    window.location.href = '@Url.Action("Odeme", "Bilet")'; // Redirect to payment page
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Hata!',
                    text: data.message
                });
            }
        })
        .catch(error => {
            Swal.fire({
                icon: 'error',
                title: 'Hata!',
                text: 'Bir hata oluştu!'
            });
        });
    }
</script>

<style>
    .bus-interior {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
    }

    .bus-section {
        margin-bottom: 20px;
        text-align: center;
    }

    .seat-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }

    .seat {
        width: 50px;
        height: 50px;
        border: 1px solid #000;
        background-color: #fff;
        cursor: pointer;
        font-size: 16px;
    }

    .selected {
        background-color: #007bff;
        color: #fff;
    }

    .aisle {
        width: 20px;
        height: 50px;
        background-color: #ccc;
    }

    .bus-section h3 {
        margin-bottom: 10px;
    }
</style>
